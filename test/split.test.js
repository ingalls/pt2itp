const fs = require('fs');
const test = require('tape');
const pg = require('pg');
const split = require('../lib/split');
const Index = require('../lib/index');
const turf = require('@turf/turf');

const pool = new pg.Pool({
    max: 10,
    user: 'postgres',
    database: 'pt_test',
    idleTimeoutMillis: 30000
});

test('Init Database', (t) => {
    const index = new Index(pool);

    index.init((err) => {
        t.error(err);
        t.end();
    });
});

test('Split: Dulaney Valley Rd, MD', (t) => {
    t.test('Populate', (q) => {
        pool.query(`
            BEGIN;

            INSERT INTO network_cluster (
                text,
                _text,
                address,
                geom
            ) VALUES (
                'dulaney vly rd',
                'Dulaney Valley Road',
                1,
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiLineString","coordinates":[[[-76.576516,39.464153,1],[-76.5769,39.463908,1],[-76.577122,39.463783,1],[-76.577421,39.463643,1],[-76.577877,39.463512,1],[-76.578492,39.463369,1]],[[-76.602014,39.402035,1],[-76.601978,39.402217,1],[-76.601954,39.402319,1],[-76.601917,39.402539,1],[-76.601845,39.402765,1]],[[-76.578492,39.463369,1],[-76.582147,39.462461,1],[-76.582404,39.462397,1]],[[-76.600369,39.41315,1],[-76.600366,39.413354,1]],[[-76.600406,39.411645,1],[-76.600382,39.412418,1]],[[-76.600492,39.410394,1],[-76.600451,39.410653,1],[-76.60041,39.41088,1],[-76.600336,39.411446,1],[-76.600406,39.411645,1]],[[-76.593006,39.450177,1],[-76.593305,39.449648,1],[-76.594053,39.448353,1]],[[-76.574924,39.464219,1],[-76.574729,39.464269,1],[-76.574219,39.464399,1],[-76.57344,39.46457,1],[-76.573092,39.464651,1],[-76.572714,39.46473,1],[-76.572136,39.464832,1],[-76.571591,39.464935,1],[-76.571038,39.46504,1],[-76.570812,39.46509,1],[-76.570619,39.465133,1],[-76.570455,39.465176,1],[-76.57018,39.465255,1],[-76.569994,39.465303,1],[-76.56971,39.465373,1],[-76.569342,39.465465,1],[-76.569079,39.465541,1],[-76.568736,39.465632,1],[-76.568498,39.4657,1],[-76.56828,39.465742,1],[-76.567992,39.465782,1],[-76.567658,39.465828,1],[-76.567398,39.465864,1],[-76.567136,39.465905,1],[-76.566835,39.46594,1],[-76.566575,39.465982,1],[-76.566107,39.466057,1],[-76.566008,39.466069,1],[-76.56593,39.466085,1],[-76.565675,39.466123,1],[-76.565167,39.466205,1],[-76.56441,39.466322,1],[-76.563693,39.466431,1],[-76.562984,39.466548,1],[-76.562633,39.466601,1]],[[-76.601239,39.405939,1],[-76.6012,39.40607,1]],[[-76.600376,39.412627,1],[-76.600373,39.412857,1]],[[-76.582404,39.462397,1],[-76.582729,39.462317,1],[-76.582965,39.462269,1],[-76.583168,39.462246,1],[-76.583408,39.462229,1],[-76.583675,39.462234,1],[-76.583948,39.462265,1],[-76.58421,39.462314,1],[-76.584724,39.462423,1],[-76.584838,39.462447,1],[-76.585182,39.462519,1],[-76.585538,39.46257,1],[-76.58583,39.462585,1],[-76.586165,39.462579,1],[-76.586339,39.462563,1],[-76.586438,39.462554,1],[-76.586804,39.462493,1],[-76.587058,39.462431,1],[-76.58736,39.462336,1],[-76.587632,39.462222,1],[-76.58787,39.462106,1],[-76.588141,39.461937,1],[-76.588385,39.461763,1],[-76.588681,39.46153,1],[-76.588933,39.461323,1],[-76.589066,39.461203,1],[-76.589203,39.461071,1]],[[-76.600382,39.412418,1],[-76.600376,39.412627,1]],[[-76.589203,39.461071,1],[-76.589278,39.460996,1],[-76.589364,39.460892,1]],[[-76.600406,39.411645,1],[-76.600489,39.411464,1],[-76.600499,39.411338,1]],[[-76.601587,39.40416,1],[-76.60152,39.404488,1]],[[-76.589364,39.460892,1],[-76.589423,39.460819,1],[-76.58947,39.460761,1],[-76.589582,39.4606,1],[-76.58975,39.460303,1],[-76.589939,39.459931,1],[-76.5905,39.458797,1],[-76.59147,39.456834,1],[-76.591905,39.455952,1],[-76.592051,39.455657,1],[-76.592176,39.455388,1],[-76.592216,39.455281,1],[-76.592274,39.455124,1],[-76.592345,39.454874,1],[-76.592391,39.454595,1],[-76.592422,39.454321,1],[-76.592426,39.454018,1],[-76.592456,39.451923,1],[-76.592464,39.451671,1],[-76.592471,39.451621,1],[-76.592494,39.451435,1],[-76.592544,39.451218,1],[-76.592609,39.451008,1],[-76.592679,39.450817,1],[-76.592798,39.45056,1],[-76.593006,39.450177,1]],[[-76.601424,39.405984,1],[-76.60148,39.405684,1],[-76.601504,39.405536,1],[-76.601565,39.405193,1]],[[-76.601334,39.4054,1],[-76.601239,39.405939,1]],[[-76.600366,39.413354,1],[-76.600345,39.413727,1],[-76.600316,39.413967,1]],[[-76.601882,39.403391,1],[-76.601901,39.403272,1],[-76.601947,39.402979,1],[-76.602005,39.402702,1],[-76.602099,39.402235,1],[-76.602138,39.402172,1],[-76.602205,39.402116,1]],[[-76.562633,39.466601,1],[-76.562225,39.466653,1],[-76.561805,39.466717,1],[-76.561565,39.466755,1],[-76.561022,39.466834,1],[-76.560887,39.466856,1],[-76.560435,39.46693,1],[-76.559938,39.467008,1],[-76.558849,39.467181,1],[-76.558268,39.467274,1],[-76.557817,39.467346,1],[-76.557552,39.467389,1],[-76.557331,39.46743,1],[-76.556974,39.467507,1],[-76.556764,39.467556,1],[-76.55646,39.467645,1],[-76.556336,39.467684,1],[-76.555562,39.467919,1],[-76.552434,39.468888,1],[-76.552262,39.468941,1],[-76.552127,39.468977,1],[-76.551989,39.469007,1],[-76.551815,39.469031,1],[-76.551611,39.469046,1],[-76.551363,39.469049,1],[-76.551169,39.469033,1],[-76.551079,39.469018,1],[-76.550969,39.468993,1],[-76.550842,39.468961,1],[-76.550705,39.468921,1],[-76.550493,39.468848,1],[-76.550352,39.468784,1],[-76.550124,39.46868,1],[-76.549697,39.468478,1],[-76.547758,39.46756,1],[-76.547661,39.467514,1],[-76.547553,39.467455,1],[-76.547479,39.467405,1],[-76.547417,39.46735,1],[-76.547329,39.467275,1]],[[-76.601276,39.406995,1],[-76.601292,39.406892,1],[-76.60137,39.406369,1]],[[-76.595458,39.445992,1],[-76.595553,39.445832,1]],[[-76.595553,39.445832,1],[-76.596122,39.444875,1],[-76.596405,39.444372,1],[-76.596528,39.444116,1],[-76.596642,39.443864,1],[-76.596711,39.44367,1],[-76.596779,39.443434,1],[-76.596843,39.44319,1],[-76.596884,39.442967,1],[-76.596913,39.442723,1],[-76.596926,39.442509,1],[-76.596928,39.441396,1],[-76.59692,39.441196,1],[-76.596918,39.44022,1]],[[-76.600499,39.411338,1],[-76.600558,39.410891,1],[-76.600593,39.410672,1],[-76.600693,39.410131,1],[-76.600774,39.409686,1]],[[-76.601737,39.404221,1],[-76.601748,39.404158,1],[-76.601804,39.403841,1]],[[-76.600056,39.414926,1],[-76.600155,39.414631,1],[-76.60021,39.414429,1],[-76.600267,39.414208,1],[-76.600316,39.413967,1]],[[-76.599893,39.41542,1],[-76.600056,39.414926,1]],[[-76.601399,39.406105,1],[-76.601424,39.405984,1]],[[-76.601804,39.403841,1],[-76.601882,39.403391,1]],[[-76.594053,39.448353,1],[-76.594626,39.4474,1],[-76.595096,39.446604,1],[-76.595325,39.446211,1],[-76.595458,39.445992,1]],[[-76.601024,39.408414,1],[-76.601042,39.408312,1],[-76.601115,39.40794,1],[-76.601167,39.407678,1]],[[-76.596918,39.44022,1],[-76.596898,39.436518,1],[-76.596897,39.436472,1],[-76.596889,39.434313,1],[-76.596867,39.431962,1],[-76.596848,39.431778,1],[-76.596803,39.43161,1],[-76.59674,39.431453,1],[-76.596661,39.431306,1],[-76.596543,39.431121,1],[-76.596502,39.431071,1],[-76.596388,39.430936,1],[-76.596057,39.430574,1],[-76.595885,39.430368,1],[-76.595766,39.430187,1],[-76.595668,39.430005,1],[-76.595582,39.429797,1],[-76.595531,39.429567,1],[-76.59552,39.4294,1],[-76.595526,39.429192,1],[-76.595553,39.429042,1],[-76.595606,39.42884,1],[-76.595626,39.428777,1],[-76.595632,39.428759,1],[-76.595783,39.428275,1],[-76.595969,39.42764,1]],[[-76.601669,39.404603,1],[-76.601685,39.404512,1],[-76.601737,39.404221,1]],[[-76.6012,39.40607,1],[-76.601134,39.406453,1],[-76.601073,39.406839,1],[-76.600943,39.407652,1],[-76.600765,39.408823,1],[-76.600711,39.409208,1],[-76.600695,39.409302,1]],[[-76.601746,39.403258,1],[-76.601724,39.403371,1],[-76.601587,39.40416,1]],[[-76.600373,39.412857,1],[-76.600369,39.41315,1]],[[-76.600774,39.409686,1],[-76.600857,39.409227,1]],[[-76.595969,39.42764,1],[-76.596092,39.427106,1]],[[-76.60152,39.404488,1],[-76.60151,39.404542,1],[-76.601503,39.404581,1],[-76.601424,39.405054,1],[-76.601342,39.405355,1],[-76.601334,39.4054,1]],[[-76.596092,39.427106,1],[-76.596147,39.426882,1],[-76.596197,39.426705,1]],[[-76.599795,39.415695,1],[-76.599893,39.41542,1]],[[-76.596197,39.426705,1],[-76.596268,39.426468,1],[-76.596369,39.42617,1],[-76.596486,39.425856,1],[-76.596596,39.425604,1],[-76.596652,39.425461,1],[-76.596766,39.425172,1],[-76.596985,39.424507,1],[-76.597012,39.424424,1],[-76.597301,39.423454,1],[-76.597402,39.423097,1],[-76.597594,39.422482,1],[-76.597965,39.421246,1],[-76.598288,39.420189,1],[-76.598626,39.419155,1],[-76.598739,39.41881,1],[-76.59892,39.418253,1],[-76.599305,39.417081,1],[-76.599795,39.415695,1]],[[-76.60137,39.406369,1],[-76.601382,39.406292,1],[-76.601399,39.406105,1]],[[-76.547329,39.467275,1],[-76.54726,39.467217,1],[-76.547139,39.467144,1],[-76.547081,39.467117,1],[-76.547032,39.467109,1],[-76.546996,39.467106,1],[-76.546973,39.467109,1],[-76.546929,39.46712,1],[-76.546904,39.467136,1],[-76.546869,39.467158,1],[-76.546825,39.467207,1],[-76.546797,39.467264,1],[-76.546605,39.467657,1],[-76.54603,39.468831,1],[-76.54575,39.469372,1],[-76.545512,39.469869,1],[-76.545393,39.470077,1],[-76.545251,39.47027,1],[-76.545103,39.470416,1],[-76.544997,39.470512,1],[-76.544834,39.47064,1],[-76.544761,39.470694,1],[-76.544603,39.470779,1],[-76.544457,39.470848,1],[-76.54441,39.470873,1],[-76.544018,39.471032,1],[-76.543776,39.471134,1],[-76.543538,39.471234,1],[-76.543104,39.471411,1],[-76.54231,39.471739,1],[-76.541944,39.47189,1],[-76.541123,39.472255,1],[-76.540592,39.472522,1],[-76.540341,39.472663,1],[-76.540136,39.472792,1],[-76.539991,39.472901,1],[-76.539904,39.472969,1],[-76.539809,39.473066,1],[-76.539338,39.473639,1],[-76.539125,39.473937,1],[-76.538945,39.474136,1],[-76.538784,39.474323,1],[-76.538611,39.474504,1],[-76.538454,39.474664,1],[-76.53804,39.475066,1],[-76.537532,39.475552,1],[-76.537352,39.475719,1],[-76.537156,39.475914,1],[-76.536873,39.476194,1],[-76.536729,39.476352,1],[-76.536634,39.476469,1],[-76.53606,39.477108,1],[-76.535863,39.477352,1],[-76.535423,39.477853,1],[-76.535117,39.478209,1],[-76.534695,39.478798,1],[-76.534547,39.47901,1],[-76.534403,39.479203,1],[-76.534359,39.479259,1],[-76.534185,39.479518,1],[-76.534044,39.479694,1],[-76.533781,39.479982,1],[-76.533702,39.480069,1],[-76.533628,39.480134,1],[-76.533574,39.480181,1],[-76.533423,39.480326,1],[-76.533282,39.480447,1],[-76.532651,39.480912,1],[-76.532109,39.481308,1],[-76.531774,39.481545,1],[-76.531448,39.481746,1],[-76.529239,39.483128,1],[-76.529073,39.483223,1],[-76.52891,39.483339,1],[-76.528772,39.483441,1],[-76.528694,39.483515,1],[-76.528616,39.483592,1],[-76.528538,39.483692,1],[-76.52846,39.483829,1],[-76.528302,39.484154,1],[-76.528199,39.484381,1],[-76.528119,39.484571,1],[-76.528069,39.484715,1],[-76.528031,39.484818,1],[-76.527997,39.484989,1],[-76.527969,39.485176,1],[-76.527957,39.485676,1],[-76.527948,39.4859,1],[-76.527937,39.486051,1],[-76.527915,39.486228,1],[-76.527783,39.487001,1],[-76.527729,39.487231,1],[-76.527653,39.487481,1],[-76.527578,39.487635,1],[-76.527503,39.487759,1],[-76.527452,39.487833,1],[-76.527384,39.487909,1],[-76.527238,39.488027,1],[-76.527171,39.488069,1],[-76.52705,39.488145,1],[-76.526918,39.488227,1],[-76.526676,39.488351,1],[-76.526464,39.488439,1],[-76.526436,39.488449,1],[-76.526212,39.488525,1],[-76.525626,39.488683,1],[-76.525343,39.488756,1],[-76.525136,39.488803,1],[-76.524699,39.488927,1],[-76.524397,39.489011,1],[-76.52425,39.48906,1],[-76.524132,39.489102,1],[-76.52397,39.489178,1],[-76.523305,39.489583,1],[-76.523107,39.489698,1],[-76.522888,39.489815,1]],[[-76.601565,39.405193,1],[-76.601669,39.404603,1]],[[-76.601845,39.402765,1],[-76.601833,39.402801,1],[-76.601746,39.403258,1]],[[-76.576516,39.464153,1],[-76.576371,39.464027,1],[-76.576276,39.463968,1],[-76.576202,39.463946,1],[-76.576118,39.463939,1],[-76.576024,39.463953,1],[-76.575812,39.464002,1],[-76.57536,39.46411,1],[-76.57509,39.464178,1],[-76.574924,39.464219,1]],[[-76.600857,39.409227,1],[-76.600978,39.408678,1],[-76.601024,39.408414,1]],[[-76.601167,39.407678,1],[-76.601226,39.407312,1],[-76.601276,39.406995,1]],[[-76.600695,39.409302,1],[-76.600492,39.410394,1]]]}'), 4326)
            );

            INSERT INTO address_cluster (
                _text,
                geom
            ) VALUES (
                '{"DULANEY VALLEY ROAD"}',
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiPoint","coordinates":[[-76.554825,39.460839,12301],[-76.567178,39.462854,12101],[-76.597763,39.442952,2106],[-76.597381,39.438022,2004],[-76.599005,39.431047,1798],[-76.599332,39.415862,1213],[-76.598647,39.41753,1225],[-76.600995,39.410555,1012],[-76.602079,39.423173,1320],[-76.594571,39.451609,2300],[-76.595055,39.459747,2300],[-76.602419,39.405303,812],[-76.597323,39.420842,1311],[-76.598909,39.416646,1219],[-76.60084,39.411361,1018],[-76.601097,39.410104,1008],[-76.598452,39.404,825],[-76.592984,39.435944,2100],[-76.599829,39.407802,949],[-76.602287,39.423609,1320],[-76.593549,39.4481,2203],[-76.601095,39.409904,1006],[-76.600076,39.416008,1202],[-76.597404,39.432329,1802],[-76.596191,39.411014,1021],[-76.597225,39.457633,2300],[-76.596336,39.452082,2300],[-76.59753,39.433314,1808],[-76.601294,39.40888,956],[-76.59391,39.449525,2204],[-76.595955,39.42509,1411],[-76.596843,39.458131,2300],[-76.592457,39.407039,1021],[-76.599057,39.421769,1310],[-76.597347,39.431869,1800],[-76.597259,39.420817,1311],[-76.599676,39.42118,1306],[-76.591964,39.412279,1021],[-76.600887,39.410925,1014],[-76.59889,39.416928,1221],[-76.600931,39.420055,1300],[-76.599494,39.417756,1214],[-76.597226,39.451942,2300],[-76.60105,39.410127,1008],[-76.597355,39.433929,1810],[-76.595201,39.447394,2124],[-76.600341,39.430875,1718],[-76.595848,39.420572,1307],[-76.597943,39.430071,1710],[-76.602784,39.42249,1318],[-76.599207,39.403309,825],[-76.598698,39.430773,1798],[-76.601148,39.402946,825],[-76.597044,39.455811,2300],[-76.599369,39.403989,825],[-76.598339,39.418525,1233],[-76.598985,39.422383,1314],[-76.598634,39.417429,1225],[-76.594387,39.411753,1021],[-76.588623,39.407698,1021],[-76.603153,39.40446,730],[-76.597373,39.439394,2010],[-76.597426,39.432264,1802],[-76.594155,39.449169,2202],[-76.592199,39.412682,1021],[-76.592441,39.408569,1021],[-76.59645,39.427759,1506],[-76.59737,39.443442,2108],[-76.603217,39.404758,744],[-76.597374,39.437583,2002],[-76.595917,39.42057,1307],[-76.597487,39.438337,2006],[-76.595421,39.446971,2122],[-76.599771,39.431002,1720],[-76.596322,39.428186,1508],[-76.599162,39.421665,1310],[-76.591846,39.413208,1021],[-76.599083,39.416125,1215],[-76.596111,39.445922,2118],[-76.597601,39.432674,1806],[-76.599338,39.422278,1314],[-76.596456,39.427725,1506],[-76.600201,39.430654,1718],[-76.597812,39.419648,1301],[-76.59619,39.428624,1510],[-76.596563,39.427385,1504],[-76.598386,39.418248,1231],[-76.596668,39.457248,2300],[-76.597256,39.443418,2108],[-76.59952,39.41803,1216],[-76.597218,39.455125,2310],[-76.601136,39.409891,1006],[-76.593866,39.449276,2204],[-76.596214,39.445898,2118],[-76.601205,39.409452,1002],[-76.599029,39.416432,1217],[-76.600982,39.410896,1014],[-76.600895,39.410942,1014],[-76.598315,39.418551,1233],[-76.600095,39.416328,1204],[-76.600101,39.416505,1206],[-76.597339,39.433247,1808],[-76.599,39.416374,1217],[-76.599997,39.416614,1206],[-76.595616,39.446501,2120],[-76.599772,39.406398,903],[-76.599616,39.417746,1214],[-76.597454,39.442942,2106],[-76.597391,39.439389,2010],[-76.599792,39.406175,903],[-76.599298,39.415773,1213],[-76.601003,39.410537,1012],[-76.597029,39.421799,1317],[-76.597338,39.435625,1908],[-76.599725,39.404793,825],[-76.594363,39.448671,2200],[-76.60084,39.411393,1018],[-76.598558,39.417723,1227],[-76.599706,39.417476,1212],[-76.600288,39.415772,1200],[-76.598731,39.417187,1223],[-76.59479,39.44797,2126],[-76.598652,39.417431,1225],[-76.599332,39.421075,1306],[-76.601524,39.421777,1322],[-76.601157,39.409676,1004],[-76.600739,39.421804,1316],[-76.59758,39.435141,1902],[-76.597246,39.431646,1800],[-76.598356,39.418517,1233],[-76.599897,39.41691,1208],[-76.597531,39.439896,2012],[-76.601384,39.408861,956],[-76.597736,39.45163,2296],[-76.595574,39.446993,2122],[-76.597378,39.433912,1810],[-76.594227,39.449188,2202],[-76.594134,39.448979,2202],[-76.596978,39.444135,2110],[-76.597356,39.432774,1806],[-76.601132,39.40387,813],[-76.598675,39.422536,1314],[-76.596631,39.426941,1502],[-76.597387,39.438919,2008],[-76.596843,39.426383,1500],[-76.599795,39.417212,1210],[-76.597364,39.437523,2002],[-76.600183,39.416076,1202],[-76.595839,39.421041,1309],[-76.597387,39.438421,2006],[-76.597375,39.43797,2004],[-76.597072,39.451993,2292],[-76.593629,39.449721,2204],[-76.593592,39.44811,2203],[-76.600867,39.411162,1016],[-76.598824,39.416906,1221],[-76.593298,39.448623,2205],[-76.600665,39.407012,901],[-76.596637,39.426856,1502],[-76.603105,39.404854,740],[-76.601053,39.410333,1010],[-76.598472,39.417984,1229],[-76.600268,39.419924,1300],[-76.590596,39.407567,1021],[-76.599531,39.417507,1214],[-76.59972,39.417213,1210],[-76.596759,39.426496,1500],[-76.597517,39.431685,1800],[-76.594833,39.447936,2126],[-76.602534,39.404707,812],[-76.591549,39.407361,1021],[-76.599537,39.418062,1216],[-76.59489,39.410153,1021],[-76.598516,39.417985,1229],[-76.601129,39.410262,1010],[-76.59791,39.453274,2300],[-76.601982,39.404271,714],[-76.596484,39.42784,1506],[-76.598507,39.418003,1229],[-76.593692,39.436317,2001],[-76.598927,39.416692,1219],[-76.602513,39.404791,820],[-76.600677,39.421963,1316],[-76.597376,39.439869,2012],[-76.598452,39.418256,1231],[-76.597041,39.444189,2110],[-76.597611,39.455451,2300],[-76.596387,39.428215,1508],[-76.596036,39.425277,1411],[-76.596499,39.453758,2300],[-76.602419,39.456389,2300],[-76.600562,39.403152,825],[-76.596255,39.428225,1508],[-76.595141,39.447435,2124],[-76.599153,39.416159,1215],[-76.59992,39.430391,1798],[-76.602351,39.404375,716],[-76.600348,39.405224,825],[-76.600305,39.415957,1202],[-76.593265,39.407821,1021],[-76.593032,39.409373,1021],[-76.600402,39.415745,1200],[-76.600449,39.419797,1300],[-76.593414,39.408362,1021],[-76.603135,39.40467,732],[-76.595735,39.446465,2120],[-76.597166,39.421044,1311],[-76.599751,39.422243,1314],[-76.593316,39.448626,2205],[-76.599915,39.416621,1206],[-76.598598,39.41783,1227],[-76.602456,39.404377,720],[-76.596808,39.426378,1500],[-76.593352,39.435989,2100],[-76.59668,39.426959,1502],[-76.595694,39.446583,2120],[-76.596806,39.421771,1317],[-76.595673,39.409889,1021],[-76.600996,39.410347,1010],[-76.594586,39.409311,1021],[-76.599178,39.41622,1215],[-76.595746,39.421003,1309],[-76.600848,39.41154,1024],[-76.597362,39.43567,1908],[-76.597474,39.435583,1902],[-76.600854,39.411138,1016],[-76.601948,39.423157,1320],[-76.60247,39.405067,828],[-76.597382,39.438471,2006],[-76.597521,39.458861,2300],[-76.594466,39.44873,2200],[-76.597407,39.433238,1808],[-76.600938,39.421852,1316],[-76.600715,39.406766,901],[-76.602503,39.405267,834],[-76.597932,39.461558,2300],[-76.60248,39.405519,838],[-76.599938,39.41676,1208],[-76.601591,39.42246,1322],[-76.601218,39.410154,1008],[-76.599237,39.415894,1213],[-76.596134,39.421098,1309],[-76.597548,39.437435,2002],[-76.601255,39.409035,956],[-76.598625,39.417741,1227],[-76.59626,39.420653,1307],[-76.601125,39.409699,1004],[-76.601273,39.408806,956],[-76.594342,39.448523,2200],[-76.600907,39.411071,1016],[-76.602408,39.404379,718],[-76.599341,39.42175,1310],[-76.593267,39.435979,2100],[-76.59984,39.416873,1208],[-76.597554,39.438802,2008],[-76.597681,39.42563,1400],[-76.59741,39.438896,2008],[-76.597522,39.443422,2108],[-76.600024,39.416291,1204],[-76.602311,39.423451,1320],[-76.600143,39.406218,903],[-76.591424,39.412213,1021],[-76.599608,39.417507,1212],[-76.59756,39.435583,1908],[-76.602521,39.40439,722],[-76.597962,39.419459,1301],[-76.599692,39.430476,1720],[-76.597371,39.442982,2106],[-76.59164,39.406302,1021],[-76.596562,39.427414,1504],[-76.602566,39.404601,806],[-76.601133,39.403835,813],[-76.601189,39.409491,1002],[-76.596157,39.428628,1510],[-76.601076,39.403862,813],[-76.599056,39.416404,1217],[-76.59794,39.407882,1021],[-76.597164,39.451877,2292],[-76.595473,39.446854,2122],[-76.597542,39.433804,1810],[-76.598822,39.431035,1798],[-76.590475,39.408255,1021],[-76.602491,39.404907,824],[-76.597371,39.439292,2010],[-76.594668,39.44779,2126],[-76.597053,39.421717,1317],[-76.597889,39.419592,1301],[-76.594592,39.459876,2300],[-76.597172,39.454906,2310],[-76.598808,39.416972,1221],[-76.589619,39.454343,2101],[-76.599856,39.416971,1210],[-76.602468,39.405141,830],[-76.601461,39.422231,1322],[-76.599777,39.430911,1720],[-76.601151,39.40983,1006],[-76.595679,39.408751,1021],[-76.599414,39.420978,1306],[-76.602469,39.404988,826],[-76.597289,39.435177,1902],[-76.60245,39.405162,812],[-76.600655,39.40697,901],[-76.59325,39.448584,2205],[-76.600943,39.411345,1018],[-76.593105,39.435949,2100],[-76.586888,39.409884,1021],[-76.595824,39.42534,1411],[-76.60151,39.455999,2300],[-76.594139,39.409897,1021],[-76.597385,39.432834,1806],[-76.602544,39.404663,810],[-76.5988,39.417202,1223],[-76.596127,39.428719,1510],[-76.601179,39.409456,1002],[-76.600206,39.415751,1200],[-76.598754,39.417221,1223],[-76.593612,39.448117,2203],[-76.600181,39.416218,1204],[-76.601172,39.410579,1012],[-76.597176,39.444152,2110],[-76.599547,39.417774,1216],[-76.597351,39.420742,1311],[-76.598451,39.418149,1231],[-76.602523,39.404749,814],[-76.598992,39.416659,1219],[-76.596546,39.427367,1504],[-76.597546,39.437861,2004],[-76.601138,39.409683,1004],[-76.590142,39.409872,1021],[-76.597697,39.432245,1802],[-76.594641,39.412796,1021],[-76.596258,39.45946,2300],[-76.597902,39.434902,1902],[-76.599596,39.417214,1212],[-76.592096,39.410693,1021],[-76.597636,39.439757,2012],[-76.595018,39.447368,2124],[-76.596901,39.450649,2296],[-76.602501,39.404858,822],[-76.596244,39.446057,2118],[-76.600717,39.403181,825],[-76.592931,39.408533,1021],[-76.527422,39.489461,13214],[-76.524296,39.490224,13218],[-76.529332,39.48453,13100],[-76.53581,39.47799,12808],[-76.534494,39.478217,12813],[-76.54733,39.468673,12450],[-76.533673,39.479453,12901],[-76.535776,39.478026,12808],[-76.547381,39.467525,12460],[-76.536176,39.478819,12814],[-76.534155,39.47879,12815],[-76.536327,39.477737,12806],[-76.536452,39.47565,12721],[-76.527098,39.488672,13200],[-76.527446,39.489787,13214],[-76.527646,39.484285,13101],[-76.5266,39.485457,13115],[-76.534229,39.478144,12813],[-76.527513,39.484715,13103],[-76.532959,39.480079,12907],[-76.526316,39.488773,13204],[-76.536438,39.477194,12804],[-76.535611,39.478386,12810],[-76.53242,39.48028,12909],[-76.533373,39.479853,12905],[-76.535126,39.476937,12807],[-76.542126,39.47142,12567],[-76.540465,39.471853,12605],[-76.528797,39.483932,13020],[-76.528179,39.483625,13019],[-76.528153,39.488047,13140],[-76.528601,39.483158,13015],[-76.542696,39.471193,12563],[-76.530886,39.481714,13001],[-76.530196,39.481963,13005],[-76.543099,39.470891,12559],[-76.530386,39.483458,13008],[-76.527728,39.484303,13101],[-76.525704,39.489134,13208],[-76.526478,39.487767,13201],[-76.528551,39.485167,13114],[-76.52491,39.489138,13212],[-76.529719,39.482139,13007],[-76.5244,39.488045,13211],[-76.533362,39.481846,12916],[-76.528304,39.484914,13100],[-76.532285,39.481983,13000],[-76.531918,39.480526,12911],[-76.525375,39.487982,13207],[-76.534599,39.477937,12811],[-76.532228,39.480735,12911],[-76.533347,39.479923,12905],[-76.532452,39.482011,13000],[-76.532122,39.481755,13000],[-76.538239,39.476193,12720],[-76.525572,39.488963,13208],[-76.54262,39.471089,12563],[-76.527037,39.485739,13115],[-76.524896,39.489117,13212],[-76.525614,39.489976,13216],[-76.535519,39.478343,12810],[-76.535733,39.47925,12900],[-76.526919,39.488556,13200],[-76.527788,39.487749,13140],[-76.546762,39.467789,12460],[-76.523206,39.490049,13224],[-76.529035,39.488489,13142],[-76.530775,39.482723,13006],[-76.534511,39.47838,12813],[-76.524917,39.487841,13209],[-76.532949,39.481702,12916],[-76.52544,39.487928,13207],[-76.531974,39.480929,12915],[-76.5469,39.468063,12460],[-76.540741,39.471394,12605],[-76.535199,39.477097,12807],[-76.53081,39.482924,13006],[-76.527738,39.484617,13103],[-76.53859,39.476546,12720],[-76.525812,39.489831,13216],[-76.527145,39.488446,13200],[-76.531789,39.481278,12919],[-76.53529,39.47963,12900],[-76.52984,39.489081,13142],[-76.531326,39.480924,12919],[-76.534891,39.477567,12809],[-76.523377,39.489891,13224],[-76.528344,39.489528,13146],[-76.540891,39.471722,12605],[-76.531352,39.481216,12919],[-76.528351,39.486595,13132],[-76.531726,39.482988,13004],[-76.536772,39.477009,12804],[-76.547599,39.468235,12450],[-76.531653,39.481153,12919],[-76.540044,39.473859,12620],[-76.53449,39.481137,12908],[-76.528888,39.489345,13144],[-76.531833,39.481432,12919],[-76.531236,39.483202,13006],[-76.534416,39.480139,12906],[-76.537912,39.473283,12615],[-76.532592,39.480467,12909],[-76.535672,39.476811,12805],[-76.531698,39.4809,12915],[-76.531388,39.482848,13004],[-76.53306,39.480151,12907],[-76.535612,39.476562,12805],[-76.536859,39.478518,12814],[-76.526761,39.48766,13201],[-76.54288,39.471166,12563],[-76.528345,39.486654,13132],[-76.53909,39.472363,12615],[-76.538383,39.473184,12615],[-76.52899,39.48392,13020],[-76.524569,39.488406,13211],[-76.532761,39.480426,12909],[-76.531284,39.482491,13004],[-76.530322,39.482996,13008],[-76.534764,39.478077,12811],[-76.525228,39.488305,13211],[-76.524118,39.489737,13218],[-76.530291,39.489484,13142],[-76.5285,39.483233,13015],[-76.529203,39.48396,13020],[-76.533692,39.479372,12901],[-76.529731,39.48227,13007],[-76.529174,39.483791,13020],[-76.525234,39.490243,13216],[-76.524616,39.490099,13218],[-76.529268,39.489676,13144],[-76.536245,39.477838,12808],[-76.534147,39.481277,12908],[-76.526276,39.487785,13201],[-76.533522,39.481988,12916],[-76.526501,39.489351,13214],[-76.530274,39.481979,13005],[-76.529869,39.490674,13146],[-76.525011,39.48901,13212],[-76.542051,39.471408,12567],[-76.536097,39.477629,12806],[-76.533931,39.479299,12901],[-76.528656,39.489053,13144],[-76.535306,39.47726,12807],[-76.531074,39.481593,13001],[-76.534476,39.480173,12906],[-76.527558,39.484734,13103],[-76.539773,39.47446,12620],[-76.531344,39.481255,12919],[-76.528792,39.485365,13114],[-76.539474,39.473041,12615],[-76.535542,39.479286,12900],[-76.529981,39.48238,13007],[-76.529085,39.48455,13100],[-76.543251,39.470856,12559],[-76.533603,39.48061,12908],[-76.52564,39.487938,13207],[-76.536649,39.475952,12721],[-76.532507,39.480697,12911],[-76.5343,39.478627,12815],[-76.547051,39.467497,12460],[-76.528087,39.48368,13019],[-76.535046,39.477689,12809],[-76.536236,39.478942,12814],[-76.52575,39.488791,13208],[-76.536389,39.477181,12804],[-76.532798,39.479805,12907],[-76.536977,39.475791,12721],[-76.533438,39.479695,12905],[-76.534611,39.477822,12811],[-76.540032,39.474527,12620],[-76.547158,39.467962,12460],[-76.528446,39.485236,13114],[-76.535016,39.477473,12809],[-76.526321,39.488546,13204],[-76.530874,39.481751,13001],[-76.53422,39.478723,12815],[-76.534114,39.480798,12908],[-76.531602,39.481262,12919],[-76.528252,39.488294,13140],[-76.526997,39.485432,13115],[-76.532887,39.48267,13000],[-76.528602,39.483445,13019],[-76.531162,39.483717,13008],[-76.523631,39.489771,13224],[-76.528778,39.48305,13015],[-76.53532,39.479613,12900],[-76.531595,39.482088,13000],[-76.526306,39.488777,13204],[-76.531757,39.480983,12915],[-76.536784,39.477446,12806],[-76.542326,39.471356,12567],[-76.53258,39.482622,13000],[-76.532483,39.482035,13000],[-76.534796,39.480469,12906],[-76.53062,39.490525,13146],[-76.543071,39.470887,12559],[-76.535908,39.47822,12810],[-76.527893,39.48416,13101],[-76.538905,39.476083,12720],[-76.54778,39.468261,12450],[-76.528436,39.48675,13132],[-76.530391,39.481947,13005],[-76.579991,39.446206,2101],[-76.580033,39.443925,2101],[-76.582554,39.444624,2101],[-76.581615,39.445157,2101],[-76.581168,39.445211,2101],[-76.583862,39.445015,2101]]}'), 4326)
            );

            COMMIT;
        `, (err, res) => {
            q.error(err);
            q.end();
        });
    });

    t.test('Run', (q) => {
        split.init({
            pool: {
                max: 10,
                user: 'postgres',
                database: 'pt_test',
                idleTimeoutMillis: 30000
            },
            stdout: false,
            debug: true,
            country: 'us'
        });

        split.split(1, (err, res) => {
            q.error(err);

            t.equals(res.length, 1);

            res = res[0];

            t.equals(res.type, 'Feature', 'Type should be feature');
            t.equals(res.geometry.type, 'GeometryCollection', 'Geometry should be GeometryCollection');
            t.equals(res.geometry.geometries.length, 2, 'GeometryCollection should have 2 child geometries');

            t.equals(res.properties['carmen:text'], 'Dulaney Valley Road', 'Text should be Dulaney Valley Road');
            t.deepEquals(res.properties['carmen:addressnumber'], [ null, [ '714', '716', '718', '720', '722', '730', '732', '740', '744', '806', '810', '812', '813', '814', '820', '822', '824', '825', '826', '828', '830', '834', '838', '901', '903', '949', '956', '1002', '1004', '1006', '1008', '1010', '1012', '1014', '1016', '1018', '1021', '1024', '1200', '1202', '1204', '1206', '1208', '1210', '1212', '1213', '1214', '1215', '1216', '1217', '1219', '1221', '1223', '1225', '1227', '1229', '1231', '1233', '1300', '1301', '1306', '1307', '1309', '1310', '1311', '1314', '1316', '1317', '1318', '1320', '1322', '1400', '1411', '1500', '1502', '1504', '1506', '1508', '1510', '1710', '1718', '1720', '1798', '1800', '1802', '1806', '1808', '1810', '1902', '1908', '2001', '2002', '2004', '2006', '2008', '2010', '2012', '2100', '2101', '2106', '2108', '2110', '2118', '2120', '2122', '2124', '2126', '2200', '2202', '2203', '2204', '2205', '2292', '2296', '2300', '2310', '12101', '12301', '12450', '12460', '12559', '12563', '12567', '12605', '12615', '12620', '12720', '12721', '12804', '12805', '12806', '12807', '12808', '12809', '12810', '12811', '12813', '12814', '12815', '12900', '12901', '12905', '12906', '12907', '12908', '12909', '12911', '12915', '12916', '12919', '13000', '13001', '13004', '13005', '13006', '13007', '13008', '13015', '13019', '13020', '13100', '13101', '13103', '13114', '13115', '13132', '13140', '13142', '13144', '13146', '13200', '13201', '13204', '13207', '13208', '13209', '13211', '13212', '13214', '13216', '13218', '13224' ] ], 'carmen:addressnumber should be stable');
            t.deepEquals(res.properties['carmen:parityl'], [ [ null, null, null, 'O', 'O', 'O', null, null, 'E', null, 'O', 'O', 'O', 'O', null, null, null, 'E', null, 'E', null, 'E', 'E', null, 'E', 'E', 'E', null, null, null, null, null ], null ], 'carmen:parityl should be stable');
            t.deepEquals(res.properties['carmen:parityr'], [ [ 'E', 'O', 'E', 'E', 'E', 'E', 'E', 'E', 'E', 'E', 'E', 'E', 'E', null, 'O', 'O', 'E', null, 'O', 'O', 'O', 'O', null, 'O', 'O', 'O', 'O', null, null, null, null, null ], null ], 'carmen:parityr should be stable');

            t.deepEquals(res.properties['carmen:lfromhn'], [ [ null, null, null, 2101, 2101, 2205, null, null, 2002, null, 1411, 1317, 1301, 1021, null, null, null, 13218, null, 13132, null, 13008, 12450, null, 12620, 12720, 12906, null, null, null, null, null ], null ], 'carmen:lfromhn should be stable');
            t.deepEquals(res.properties['carmen:ltohn'], [ [ 0, null, null, 2101, 2101, 2203, null, null, 1806, null, 1411, 1301, 1213, 1021, null, null, null, 13224, null, 13212, null, 13114, 12450, null, 12720, 12900, 20000, null, null, null, null, null ], null ], 'carmen:ltohn should be stable');

            t.deepEquals(res.properties['carmen:rfromhn'], [ [ 838, 1021, 2300, 2300, 2300, 2204, 2118, 2012, 2100, 1802, 1508, 1320, 1300, null, 825, 903, 1024, null, 12101, 13201, 12301, 13007, null, 12559, 12605, 12721, 12901, null, null, null, null, null ], null ], 'carmen:rfromhn should be stable');
            t.deepEquals(res.properties['carmen:rtohn'], [ [ 0, 1021, 2300, 2310, 2296, 2120, 2106, 2002, 1806, 1510, 1400, 1300, 1200, null, 903, 1021, 956, null, 12101, 13211, 12301, 13115, null, 12605, 12615, 12901, 20001, null, null, null, null, null ], null ], 'carmen:rtohn should be stable');

            split.kill();
            q.end();
        });
    });

    t.end();
});

test('Split: East Long Street', (t) => {
    t.test('Populate', (q) => {
        pool.query(`
            BEGIN;

            INSERT INTO network_cluster (
                text,
                _text,
                address,
                geom
            ) VALUES (
                'e long st',
                'East Long Street',
                2,
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiLineString","coordinates":[[[-82.981705,39.967187,2],[-82.98164,39.967194,2],[-82.981062,39.967263,2],[-82.980273,39.967342,2],[-82.979299,39.967451,2],[-82.978513,39.967543,2],[-82.977825,39.967621,2],[-82.977585,39.967648,2],[-82.977166,39.967695,2],[-82.975909,39.967835,2],[-82.975826,39.967844,2],[-82.975051,39.967929,2],[-82.974738,39.967966,2],[-82.974273,39.968018,2],[-82.973596,39.968093,2],[-82.972728,39.968196,2],[-82.97244,39.968231,2],[-82.971252,39.968358,2],[-82.969984,39.96851,2],[-82.969317,39.968583,2],[-82.968381,39.968688,2]],[[-82.968381,39.968688,2],[-82.967027,39.968846,2],[-82.966044,39.968956,2],[-82.965702,39.968993,2],[-82.965588,39.969002,2],[-82.965413,39.969003,2],[-82.965208,39.968993,2],[-82.964301,39.96895,2],[-82.963813,39.96893,2],[-82.963669,39.968923,2],[-82.96199,39.96884,2],[-82.961583,39.968823,2],[-82.959814,39.968732,2],[-82.958673,39.968673,2],[-82.95741,39.968608,2],[-82.956712,39.968573,2],[-82.955833,39.968529,2],[-82.955491,39.968525,2],[-82.955196,39.96855,2],[-82.954891,39.968604,2],[-82.954592,39.968658,2],[-82.954106,39.968744,2],[-82.953976,39.968759,2],[-82.953531,39.968812,2],[-82.952596,39.968917,2],[-82.952053,39.968979,2]],[[-82.982673,39.967079,2],[-82.982294,39.967115,2],[-82.981705,39.967187,2]],[[-82.98282,39.967062,2],[-82.982673,39.967079,2]],[[-82.983925,39.966928,2],[-82.98282,39.967062,2]],[[-83.001169,39.96494,2],[-83.000268,39.965044,2],[-82.99938,39.965147,2],[-82.999229,39.965164,2],[-82.998505,39.965248,2]],[[-82.98396,39.966924,2],[-82.983925,39.966928,2]],[[-82.990468,39.966197,2],[-82.98951,39.966307,2],[-82.989262,39.966336,2],[-82.988896,39.966378,2],[-82.988746,39.966395,2],[-82.987613,39.966527,2],[-82.98721,39.966574,2],[-82.986959,39.966604,2],[-82.986685,39.966636,2],[-82.986085,39.966707,2],[-82.985939,39.966712,2],[-82.985836,39.966721,2],[-82.985684,39.966732,2],[-82.984929,39.966818,2],[-82.98396,39.966924,2]],[[-82.996768,39.965443,2],[-82.996061,39.965527,2],[-82.995904,39.965545,2],[-82.995406,39.965603,2],[-82.994919,39.965657,2],[-82.994066,39.965758,2],[-82.99382,39.965784,2],[-82.992838,39.965898,2],[-82.992719,39.965912,2],[-82.992226,39.965972,2],[-82.99217,39.965979,2],[-82.991587,39.966073,2],[-82.991477,39.966085,2],[-82.991024,39.966137,2],[-82.990552,39.966187,2],[-82.990468,39.966197,2]],[[-82.998505,39.965248,2],[-82.997642,39.965345,2],[-82.996768,39.965443,2]],[[-82.952053,39.968979,2],[-82.950256,39.969177,2]]]}'), 4326)
            );

            INSERT INTO address_cluster (
                _text,
                geom
            ) VALUES (
                '{"East Long Street"}',
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiPoint","coordinates":[[-82.967928,39.969044,1240],[-82.997858,39.965519,124],[-82.955,39.968307,1727],[-82.974059,39.968262,1022],[-82.963026,39.968742,1433],[-82.960813,39.969075,1514],[-82.972009,39.967987,1093],[-82.977671,39.967514,879],[-82.972932,39.967876,1059],[-82.993616,39.965448,295],[-82.959286,39.969001,1570],[-82.954585,39.969858,1734],[-82.954659,39.970002,1736],[-82.97275,39.96842,1070],[-82.956456,39.96832,1673],[-82.956187,39.968217,1685],[-82.993069,39.965627,295],[-82.992969,39.965628,295],[-82.970605,39.968212,1147],[-82.980748,39.967171,769],[-82.959286,39.969001,1572],[-82.981187,39.967366,740],[-82.99516,39.965421,217],[-82.993347,39.965579,295],[-82.960813,39.969075,1514],[-82.955906,39.96821,1695],[-82.967307,39.969115,1276],[-82.993256,39.965454,295],[-82.975603,39.968143,964],[-82.996283,39.965339,165],[-82.954657,39.969285,1730],[-82.954142,39.968885,1764],[-82.980782,39.967061,769],[-82.954921,39.969346,1730],[-82.980038,39.967106,797],[-82.992576,39.965802,315],[-82.973428,39.968415,1046],[-82.963057,39.968743,1431],[-82.992826,39.965643,295],[-82.993334,39.965703,295],[-82.961274,39.969095,1500],[-82.969428,39.968859,1192],[-82.980038,39.967106,793],[-82.986123,39.96693,564],[-82.974438,39.967867,1005],[-82.954737,39.969383,1730],[-82.975752,39.967991,954],[-82.967321,39.968489,1271],[-82.954732,39.968925,1728],[-82.993261,39.965528,295],[-82.960617,39.969064,1522],[-82.98511,39.966954,600],[-82.972932,39.967876,1059],[-82.992849,39.965728,295],[-82.993055,39.965586,295],[-82.972875,39.968413,1066],[-82.960617,39.969064,1524],[-82.965527,39.968672,1337],[-82.963157,39.968749,1427],[-82.965713,39.968679,1331],[-82.993148,39.965485,295],[-82.954553,39.970087,1736],[-82.953652,39.968949,1780],[-82.954597,39.969767,1734],[-82.954436,39.968858,1750],[-82.979536,39.967298,809],[-82.954852,39.969294,1730],[-82.978035,39.967482,859],[-82.970808,39.968714,1144],[-82.954597,39.969767,1734],[-82.95484,39.969388,1730],[-82.954653,39.968844,1728],[-82.984291,39.966718,639],[-82.979671,39.967267,805],[-82.954569,39.968358,1743],[-82.954749,39.970098,1736],[-82.99347,39.965407,295],[-82.995965,39.965717,190],[-82.992856,39.965749,295],[-82.992824,39.965622,295],[-82.954709,39.969613,1732],[-82.986123,39.96693,564],[-82.993976,39.965959,266],[-82.995534,39.965364,203],[-83.000732,39.964862,5],[-82.976632,39.967916,922],[-82.96587,39.968684,1323],[-82.953203,39.969011,1796],[-82.954761,39.970005,1736],[-82.970723,39.968204,1143],[-82.95562,39.968225,1705],[-82.960121,39.969017,1540],[-82.970355,39.968771,1160],[-82.97068,39.968731,1146],[-82.952916,39.968655,1805],[-82.999904,39.965479,42],[-82.993477,39.965467,295],[-82.964796,39.969254,1370],[-82.981971,39.967008,717],[-82.993148,39.966006,300],[-82.982417,39.966988,701],[-82.977422,39.96754,889],[-82.952868,39.96874,1805],[-82.969674,39.968845,1186],[-82.999871,39.964728,45],[-82.962144,39.968542,1465],[-82.98433,39.96719,634],[-82.954657,39.969285,1730],[-82.963573,39.968752,1413],[-82.973015,39.968461,1060],[-82.986679,39.966417,545],[-82.969079,39.968323,1205],[-82.980119,39.967482,790],[-82.996218,39.96565,182],[-82.968954,39.968334,1209],[-82.954653,39.968844,1728],[-82.965214,39.968678,1353],[-82.982296,39.966833,705],[-82.999933,39.965481,50],[-82.96637,39.96922,1312],[-82.952933,39.968734,1805],[-82.97043,39.968218,1151],[-82.965018,39.969264,1360],[-82.976334,39.967544,929],[-82.977049,39.967862,134],[-82.958511,39.968356,1597],[-82.969556,39.96826,1187],[-82.968073,39.968453,1243],[-82.994199,39.965508,255],[-82.952925,39.969037,1806],[-82.954852,39.969294,1730],[-82.960813,39.969075,1514],[-82.989991,39.965972,112],[-82.969079,39.968323,1205],[-82.993527,39.965659,295],[-82.965418,39.969256,1348],[-82.967945,39.968459,1247],[-82.994591,39.965513,255],[-82.969674,39.968845,1186],[-82.994482,39.96547,255],[-82.972932,39.967876,1059],[-82.955503,39.968247,1709],[-82.971517,39.968626,1118],[-82.96274,39.968705,1441],[-82.959036,39.968379,1581],[-82.95415,39.968873,1762],[-82.952925,39.969037,1806],[-82.954746,39.970098,1736],[-82.980487,39.967538,768],[-82.994193,39.965509,255],[-82.977896,39.967477,871],[-82.972021,39.968486,1098],[-82.965527,39.968672,1341],[-82.952925,39.969037,1806],[-82.972115,39.96842,1094],[-82.99315,39.965704,295],[-82.992911,39.965443,295],[-82.992926,39.965534,295],[-82.962882,39.968718,1437],[-82.954715,39.970348,1738],[-82.954613,39.970343,1738],[-82.967321,39.968489,1271],[-82.993539,39.965679,295],[-82.959346,39.968389,1567],[-82.978249,39.967413,855],[-82.95452,39.970336,1738],[-82.981315,39.967351,736],[-82.993398,39.965545,295],[-82.954625,39.970252,1738],[-82.965713,39.968679,1331],[-82.954637,39.968996,1728],[-82.993532,39.965658,295],[-82.960813,39.969075,1514],[-82.96796,39.968607,1251],[-82.993655,39.965633,295],[-82.966993,39.969149,1290],[-82.993483,39.965488,295],[-82.954701,39.968804,1728],[-82.972252,39.968066,1085],[-82.993591,39.965381,295],[-82.954613,39.970343,1738],[-82.962772,39.968671,1441],[-82.972579,39.967922,1071],[-82.992236,39.965756,331],[-82.979161,39.967285,821],[-82.9626,39.9687,1449],[-82.993354,39.9656,295],[-82.993596,39.96538,295],[-82.952768,39.968666,1811],[-82.992924,39.965484,295],[-82.961434,39.969102,1492],[-82.972932,39.967876,1059],[-82.960813,39.969075,1514],[-82.95452,39.970336,1738],[-82.954722,39.969001,1728],[-82.970951,39.968192,1133],[-82.970833,39.968198,1137],[-82.954657,39.969285,1730],[-82.993172,39.96556,295],[-82.966744,39.969178,1300],[-82.972693,39.967896,1069],[-82.993487,39.965588,295],[-82.993475,39.965394,295],[-82.971803,39.968595,1108],[-82.953203,39.969011,1796],[-82.980009,39.967095,97],[-82.954727,39.970254,1738],[-82.95469,39.969774,1734],[-82.960813,39.969075,1514],[-82.993617,39.965469,295],[-82.964075,39.968786,1395],[-82.996369,39.965641,176],[-82.967421,39.969101,1272],[-82.954644,39.969376,1730],[-82.976871,39.967871,916],[-82.953203,39.969011,1796],[-82.954628,39.969515,1732],[-82.954761,39.970005,1736],[-82.961759,39.968552,1477],[-82.962148,39.969127,1466],[-82.993391,39.965991,288],[-82.954737,39.969383,1730],[-82.964889,39.968663,1365],[-82.970484,39.968759,1154],[-82.993915,39.965392,255],[-82.963842,39.968774,1401],[-82.95632,39.968269,1679],[-82.975378,39.968177,972],[-82.973347,39.968028,1047],[-82.954823,39.969524,1732],[-82.993115,39.965601,295],[-82.993115,39.965601,295],[-82.975707,39.967659,955],[-82.971646,39.968612,1112],[-82.999055,39.965524,78],[-82.959189,39.968381,1573],[-82.994072,39.965578,255],[-82.958975,39.968986,1582],[-82.974087,39.968157,1020],[-82.954678,39.969865,1734],[-82.997417,39.965749,136],[-82.965724,39.969272,1334],[-82.993262,39.965474,295],[-82.993413,39.96565,295],[-82.965403,39.968667,1345],[-82.982365,39.966829,703],[-82.977492,39.967814,896],[-82.966814,39.968513,1291],[-82.965146,39.969272,1356],[-82.954727,39.970254,1738],[-82.993267,39.965549,295],[-82.994321,39.965366,255],[-82.954732,39.968925,1728],[-82.977304,39.967551,93],[-82.954715,39.970348,1738],[-82.954532,39.970245,1738],[-82.954566,39.969995,1736],[-82.954741,39.96885,1728],[-82.994592,39.965522,255],[-82.981971,39.967008,721],[-82.953683,39.968232,1751],[-82.980038,39.967106,791],[-82.963461,39.96874,1417],[-82.954741,39.96885,1728],[-82.993263,39.965474,295],[-82.98576,39.966904,580],[-82.954732,39.968925,1728],[-82.993799,39.965954,274],[-82.954553,39.970087,1736],[-82.985874,39.966594,569],[-82.992962,39.965608,295],[-82.976401,39.967931,928],[-82.970808,39.968714,1142],[-82.95278,39.968746,1811],[-82.993062,39.965606,295],[-82.982368,39.966936,703],[-82.995302,39.965882,218],[-82.954749,39.969292,1730],[-82.994658,39.965288,255],[-82.992213,39.965771,331],[-82.973724,39.968279,1032],[-82.97212,39.967976,1091],[-82.9928,39.965497,295],[-82.994157,39.965516,255],[-82.963825,39.968773,1403],[-82.993162,39.965725,295],[-82.984368,39.967023,628],[-82.99396,39.96557,255],[-82.965035,39.968671,1359],[-82.982041,39.967329,720],[-82.964414,39.969233,1382],[-82.994602,39.96536,255],[-82.993405,39.965565,295],[-82.994173,39.965572,255],[-82.968533,39.968822,1230],[-82.969435,39.968275,1191],[-82.966814,39.968513,1289],[-82.993179,39.965581,295],[-82.99398,39.9654,255],[-82.953064,39.969025,1802],[-82.993122,39.965622,295],[-82.973175,39.967903,1049],[-82.955432,39.968958,1714],[-82.969247,39.968443,1201],[-83.000575,39.965131,10],[-82.970672,39.968572,1148],[-82.979408,39.967323,817],[-82.992275,39.965687,331],[-82.973286,39.968429,1050],[-82.954678,39.969865,1734],[-82.993081,39.965692,295],[-82.972252,39.968066,1083],[-82.981885,39.967052,711],[-82.979406,39.967578,818],[-82.95478,39.96987,1734],[-82.993405,39.965565,295],[-82.994657,39.965294,255],[-82.972266,39.968543,1088],[-82.969047,39.968891,1208],[-82.954646,39.970094,1736],[-82.99342,39.965671,295],[-82.968911,39.968897,1212],[-82.994664,39.965291,255],[-82.973428,39.968415,1044],[-82.954566,39.969995,1736],[-82.99334,39.965559,295],[-82.993274,39.96557,295],[-82.954823,39.969524,1732],[-82.993267,39.965549,295],[-82.994619,39.965279,255],[-82.965035,39.968671,1357],[-82.9687,39.968835,1222],[-83.000815,39.965104,4],[-82.993629,39.965489,295],[-82.994669,39.965379,255],[-82.993327,39.965682,295],[-82.954727,39.970254,1738],[-82.958879,39.968371,1587],[-82.966744,39.969178,1298],[-82.993166,39.96554,295],[-82.971603,39.968151,1115],[-82.993342,39.96558,295],[-82.981971,39.967008,713],[-82.952852,39.968659,1805],[-82.955503,39.968247,1707],[-82.954732,39.968925,1728],[-82.992831,39.965642,295],[-82.981029,39.967569,758],[-82.963965,39.969211,1398],[-82.952622,39.969085,1818],[-82.992226,39.965851,331],[-82.970605,39.968212,1149],[-82.99144,39.966176,360],[-82.95945,39.969009,1564],[-82.973286,39.968429,1048],[-82.993921,39.965444,255],[-82.977705,39.967763,882],[-82.993927,39.965442,255],[-82.993475,39.965567,295],[-82.954852,39.969294,1730],[-82.993474,39.965546,295],[-82.953499,39.968969,1786],[-82.98619,39.96634,555],[-82.993322,39.965683,295],[-82.960813,39.969075,1514],[-82.992978,39.965724,295],[-82.994437,39.96548,255],[-82.965149,39.968676,1355],[-82.954659,39.970002,1736],[-82.954837,39.969388,1730],[-82.980872,39.967569,764],[-82.970419,39.968177,1159],[-82.993327,39.965682,295],[-82.954616,39.969606,1732],[-82.954792,39.969776,1734],[-82.994153,39.965513,255],[-82.993155,39.965704,295],[-82.992234,39.965748,331],[-82.993411,39.965586,295],[-82.966814,39.968513,1293],[-82.992356,39.965825,325],[-82.994489,39.965535,255],[-82.95452,39.970336,1738],[-82.953203,39.969011,1796],[-82.977039,39.967586,905],[-82.962719,39.968668,1441],[-82.9629,39.968718,1435],[-82.954709,39.969613,1732],[-82.994187,39.965508,255],[-82.954678,39.969865,1734],[-82.975589,39.96766,959],[-82.993108,39.965581,295],[-82.977425,39.96754,891],[-82.982515,39.966975,695],[-83.001004,39.96508,2],[-82.965574,39.969267,1340],[-82.994427,39.96554,255],[-82.994589,39.965518,255],[-82.958361,39.968815,1600],[-82.99461,39.965361,255],[-82.99434,39.96541,255],[-82.960399,39.969052,1530],[-82.994102,39.965521,255],[-82.994542,39.965471,255],[-82.993947,39.965372,255],[-82.993995,39.965442,255],[-82.994697,39.965474,255],[-82.994584,39.965514,255],[-82.962718,39.968685,1441],[-82.993602,39.965401,295],[-82.95484,39.968327,1731],[-82.958268,39.968338,1607],[-82.993481,39.965415,295],[-82.994243,39.965554,255],[-82.970112,39.968719,1166],[-82.954737,39.969383,1730],[-82.993142,39.965464,295],[-82.99425,39.965371,255],[-82.994256,39.965422,255],[-82.979414,39.967175,815],[-82.994258,39.965369,255],[-82.99365,39.965634,295],[-82.994334,39.965407,255],[-82.977425,39.96754,893],[-82.97619,39.967454,933],[-82.992968,39.965628,295],[-82.994232,39.965556,255],[-82.962241,39.968641,1459],[-82.99443,39.965544,255],[-82.954864,39.969826,1734],[-82.99415,39.965518,255],[-82.994536,39.965467,255],[-82.994537,39.965457,255],[-82.994236,39.96556,255],[-82.992283,39.965686,331],[-82.994691,39.965477,255],[-82.980499,39.967197,777],[-82.961741,39.969052,1484],[-82.954644,39.969376,1730],[-82.994171,39.965565,255],[-82.994268,39.965416,255],[-82.993949,39.965521,255],[-82.994329,39.965411,255],[-82.992973,39.965725,295],[-82.987432,39.966439,509],[-82.99392,39.965394,255],[-82.993994,39.965434,255],[-82.993639,39.965546,295],[-82.994601,39.965322,255],[-82.99394,39.965575,255],[-82.99462,39.965274,255],[-82.994322,39.965375,255],[-82.950835,39.969213,1886],[-82.969428,39.968859,1190],[-82.984116,39.967087,640],[-82.998817,39.965408,86],[-82.993927,39.965447,255],[-82.993951,39.965368,255],[-82.994539,39.965462,255],[-82.99471,39.965474,255],[-82.993655,39.965633,295],[-82.993909,39.965395,255],[-82.991172,39.966212,374],[-82.956048,39.968209,1689],[-82.993172,39.96556,295],[-82.96829,39.968782,1236],[-82.994669,39.965346,255],[-82.993933,39.965443,255],[-82.994336,39.965412,255],[-82.993944,39.965524,255],[-82.994614,39.96527,255],[-82.994326,39.965362,255],[-82.994229,39.965561,255],[-82.993989,39.96544,255],[-82.994177,39.965564,255],[-82.994613,39.965275,255],[-82.992222,39.96577,331],[-82.994275,39.965418,255],[-82.993167,39.965561,295],[-82.994489,39.965526,255],[-82.993648,39.965613,295],[-82.993946,39.965363,255],[-82.994066,39.965579,255],[-82.99407,39.965583,255],[-82.992913,39.965477,295],[-82.992287,39.965784,331],[-83.000615,39.96487,9],[-82.962771,39.968689,1441],[-82.995789,39.965417,195],[-82.997519,39.965499,134],[-82.993634,39.965547,295],[-82.994587,39.965509,255],[-82.993945,39.965572,255],[-82.967421,39.969101,1274],[-82.994698,39.965449,255],[-82.994686,39.965451,255],[-82.993943,39.965519,255],[-82.952996,39.968493,1801],[-82.994327,39.965367,255],[-82.994068,39.965574,255],[-82.981454,39.967334,732],[-82.994345,39.965406,255],[-82.954644,39.969376,1730],[-82.994334,39.965364,255],[-82.994487,39.965473,255],[-82.994485,39.965522,255],[-82.994195,39.965515,255],[-82.954815,39.970307,1738],[-82.954823,39.969524,1732],[-82.976654,39.967645,915],[-82.994093,39.965513,255],[-82.993623,39.965468,295],[-82.981251,39.967357,738],[-82.954628,39.969515,1732],[-82.993262,39.965474,295],[-82.994175,39.965569,255],[-82.992787,39.965456,295],[-82.95484,39.969388,1730],[-82.967189,39.968495,1275],[-82.994446,39.965479,255],[-82.980937,39.967113,761],[-82.976871,39.967871,914],[-82.994324,39.965593,255],[-82.967945,39.968459,1249],[-82.954721,39.969522,1732],[-82.954749,39.970098,1736],[-82.994094,39.965522,255],[-82.994097,39.965517,255],[-82.993136,39.965465,295],[-82.966943,39.968507,1285],[-82.994691,39.965448,255],[-82.994479,39.965474,255],[-82.964543,39.969241,1378],[-82.965527,39.968672,1339],[-82.955221,39.968281,1715],[-82.975589,39.96766,961],[-82.975147,39.968194,980],[-82.994261,39.965419,255],[-82.993952,39.965568,255],[-82.993937,39.965522,255],[-82.993284,39.966005,294],[-82.962506,39.968703,1451],[-82.994276,39.965548,255],[-82.960813,39.969075,1514],[-82.964118,39.969215,1394],[-82.95945,39.969009,1562],[-82.982206,39.967004,709],[-82.960813,39.969075,1514],[-82.976076,39.967476,937],[-82.970112,39.968719,1166],[-82.960399,39.969052,1530],[-82.993471,39.965468,295],[-82.963235,39.968752,1425],[-82.954792,39.969776,1734],[-82.979194,39.967346,827],[-82.955763,39.968213,1697],[-82.959136,39.968993,1578],[-82.993468,39.965373,295],[-82.954722,39.969001,1728],[-82.992284,39.965776,331],[-82.992849,39.965728,295],[-82.994484,39.965527,255],[-82.954721,39.969522,1732],[-82.99444,39.965475,255],[-82.994757,39.96595,236],[-82.963825,39.968773,1403],[-82.994704,39.965477,255],[-82.994697,39.965479,255],[-82.999933,39.965481,50],[-82.966993,39.969149,1290],[-82.993069,39.965627,295],[-82.993914,39.965397,255],[-82.992794,39.965476,295],[-82.960813,39.969075,1514],[-82.992964,39.965629,295],[-82.980637,39.967181,773],[-82.977428,39.967899,892],[-82.984472,39.966997,628],[-82.964578,39.968654,1375],[-82.967149,39.968959,1282],[-82.953064,39.969025,1802],[-82.967182,39.969129,1280],[-82.992918,39.965463,295],[-82.992971,39.965704,295],[-82.993262,39.965549,295],[-82.954749,39.969292,1730],[-82.998332,39.965429,104],[-82.95411,39.968878,1768],[-82.956609,39.968224,1667],[-82.993082,39.965713,295],[-82.961898,39.969112,1476],[-82.95945,39.969009,1562],[-82.993944,39.965367,255],[-82.954625,39.970252,1738],[-82.994099,39.965527,255],[-82.993646,39.965567,295],[-82.959607,39.969016,1558],[-82.960813,39.969075,1514],[-82.966943,39.968507,1283],[-82.994156,39.96552,255],[-82.954645,39.96892,1728],[-82.995669,39.965715,202],[-82.992842,39.965708,295],[-82.994428,39.965535,255],[-82.994194,39.965505,255],[-82.996283,39.965339,165],[-82.963359,39.968754,1419],[-82.994486,39.965531,255],[-82.994651,39.965292,255],[-82.994265,39.965372,255],[-82.954613,39.970343,1738],[-82.976481,39.967615,923],[-82.994423,39.965535,255],[-82.992844,39.965729,295],[-82.994481,39.965465,255],[-82.994425,39.965531,255],[-82.964446,39.968643,1381],[-82.9934,39.965566,295],[-82.994173,39.965561,255],[-82.954532,39.970245,1738],[-82.973136,39.968446,1054],[-82.963503,39.968768,1415],[-82.994692,39.965452,255],[-82.975603,39.968143,962],[-82.994663,39.965351,255],[-82.994484,39.965478,255],[-82.994439,39.96547,255],[-82.972932,39.967876,1059],[-82.99342,39.965671,295],[-82.99467,39.965354,255],[-82.969039,39.968779,1210],[-82.964742,39.968656,1371],[-82.952996,39.968493,1799],[-82.954811,39.969618,1732],[-82.99311,39.965602,295],[-82.992806,39.965544,295],[-82.95562,39.968225,1703],[-82.993477,39.965467,295],[-82.964918,39.969242,1366],[-82.985964,39.966593,555],[-82.952768,39.969059,1810],[-82.974046,39.967899,1019],[-82.993258,39.965475,295],[-82.981971,39.967008,719],[-82.952996,39.968493,1795],[-82.966744,39.969178,1298],[-82.95469,39.969774,1734],[-82.982402,39.966932,703],[-82.993587,39.966029,278],[-82.971803,39.968595,1110],[-82.980425,39.967203,779],[-82.96622,39.969237,1318],[-82.999904,39.965479,48],[-82.960813,39.969075,1514],[-82.978105,39.967754,860],[-82.952925,39.969037,1806],[-82.993149,39.965683,295],[-82.975042,39.968093,984],[-82.9755,39.968165,968],[-82.968227,39.96851,1245],[-82.97491,39.968107,988],[-82.972163,39.968555,1092],[-82.964543,39.969241,1378],[-82.981193,39.96756,750],[-82.989592,39.966153,423],[-82.99348,39.965567,295],[-82.993087,39.965712,295],[-82.96087,39.968451,1511],[-82.973046,39.967868,1057],[-83.000672,39.965122,8],[-82.953284,39.96945,1824],[-82.980038,39.967106,795],[-82.968726,39.96836,1219],[-82.972932,39.967876,1059],[-82.971065,39.968683,1132],[-82.993149,39.965683,295],[-82.993321,39.965662,295],[-82.982395,39.96699,703],[-82.999904,39.965479,44],[-82.981129,39.967107,747],[-82.960813,39.969075,1514],[-82.96967,39.968246,1183],[-82.993532,39.965658,295],[-82.992937,39.965554,295],[-82.992246,39.965848,329],[-82.965018,39.969264,1362],[-82.965724,39.969272,1336],[-82.954921,39.969346,1730],[-82.980748,39.967171,769],[-82.96955,39.968853,1192],[-82.954653,39.968844,1728],[-82.969428,39.968859,1194],[-82.9527,39.968675,1811],[-82.95966,39.968415,1557],[-82.975589,39.96766,959],[-82.955763,39.968213,1699],[-82.992813,39.965565,295],[-82.954811,39.969618,1732],[-82.993526,39.965638,295],[-82.954122,39.968887,1766],[-82.992984,39.965745,295],[-82.992842,39.965708,295],[-82.952925,39.969037,1806],[-82.994554,39.965967,242],[-82.992975,39.965649,295],[-82.954761,39.970005,1736],[-82.977428,39.967899,894],[-82.959036,39.968379,1579],[-82.964742,39.968656,1369],[-82.976632,39.967916,920],[-82.993135,39.965444,295],[-82.999904,39.965479,46],[-82.993347,39.965579,295],[-82.997858,39.965519,116],[-82.999491,39.965259,60],[-82.971078,39.968496,1130],[-82.954566,39.969995,1736],[-82.993087,39.965712,295],[-82.954645,39.96892,1728],[-82.970833,39.968198,1139],[-83.000767,39.965109,6],[-82.998843,39.965609,84],[-82.954646,39.970094,1736],[-82.972932,39.967876,1059],[-82.952721,39.96875,1811],[-82.982422,39.966821,701],[-82.959496,39.968399,1561],[-82.979161,39.967285,825],[-82.954712,39.970348,1738],[-82.968801,39.968903,1218],[-82.966872,39.969163,1294],[-82.981375,39.967343,734],[-82.952345,39.968767,1829],[-82.95489,39.969575,1732],[-82.954808,39.969618,1732],[-82.967446,39.968483,1265],[-82.973724,39.968279,1032],[-82.966623,39.969192,1304],[-82.99348,39.965567,295],[-82.979161,39.967285,823],[-82.982373,39.966993,705],[-82.980741,39.967141,769],[-82.997886,39.965453,118],[-82.964543,39.969241,1376],[-82.954553,39.970087,1736],[-82.992837,39.965663,295],[-82.954847,39.970059,1736],[-82.992788,39.965477,295],[-82.994959,39.965268,223],[-82.954597,39.969767,1734],[-82.954741,39.96885,1728],[-82.954637,39.968996,1728],[-82.991866,39.966264,342],[-82.953203,39.969011,1796],[-82.992819,39.965586,295],[-82.986914,39.966847,534],[-82.970231,39.968788,1164],[-82.953349,39.968977,1792],[-82.971367,39.968599,1120],[-82.992924,39.965513,295],[-82.954301,39.968878,1758],[-82.972825,39.967899,1063],[-82.953064,39.969025,1802],[-82.971803,39.968595,1106],[-82.99347,39.965447,295],[-82.961066,39.969027,1506],[-82.967321,39.968489,1271],[-82.97619,39.967454,935],[-82.993094,39.965733,295],[-82.981971,39.967008,723],[-82.975268,39.968185,976],[-82.997858,39.965519,120],[-82.981525,39.967326,730],[-82.993062,39.965606,295],[-82.993415,39.965671,295],[-82.995283,39.965234,211],[-82.955193,39.968957,1720],[-82.967553,39.969086,1268],[-82.993057,39.965607,295],[-82.953064,39.969025,1802],[-82.964261,39.969226,1388],[-82.955906,39.96821,1693],[-82.992978,39.965724,295],[-82.9633,39.96875,1421],[-82.969789,39.968839,1180],[-82.960267,39.969005,1536],[-82.992808,39.965565,295],[-82.984291,39.966718,639],[-82.969428,39.968859,1196],[-82.963969,39.96878,1399],[-82.986376,39.966904,556],[-82.994603,39.965366,255],[-82.993249,39.965686,295],[-82.992931,39.965533,295],[-82.967585,39.968477,1261],[-82.961244,39.968944,1502],[-82.965842,39.969274,1330],[-82.969168,39.968885,1204],[-82.954646,39.970094,1736],[-82.954625,39.970252,1738],[-82.999941,39.965217,40],[-82.964118,39.969215,1396],[-83.000421,39.965148,18],[-82.980688,39.967176,771],[-82.954792,39.969776,1734],[-82.954585,39.969858,1734],[-82.966943,39.968507,1285],[-82.994073,39.965586,255],[-82.994545,39.965466,255],[-82.982382,39.966924,703],[-82.968517,39.968569,1223],[-82.977671,39.967514,879],[-82.99415,39.965509,255],[-82.994284,39.966108,256],[-82.994257,39.965374,255],[-82.967827,39.968465,1253],[-82.954585,39.969858,1734],[-82.996539,39.965629,174],[-82.977425,39.96754,885],[-82.997858,39.965519,122],[-82.96587,39.968684,1323],[-82.976076,39.967476,939],[-82.972618,39.968314,1072],[-82.954792,39.969776,1734],[-82.995619,39.965199,199],[-82.994443,39.965484,255],[-82.973175,39.967903,1049],[-82.954616,39.969606,1732],[-82.954709,39.969613,1732],[-82.954637,39.968996,1728],[-83.000498,39.965139,14],[-82.981304,39.96709,741],[-82.971942,39.968578,1102],[-82.967695,39.968471,1257],[-82.972932,39.967876,1059],[-82.994978,39.965927,232],[-82.954616,39.969606,1732],[-82.971803,39.968595,1104],[-83.000834,39.964852,3],[-82.970231,39.968788,1162],[-82.968911,39.9689,1212],[-82.994268,39.965421,255],[-82.972926,39.968469,1064],[-82.993953,39.965573,255],[-82.954628,39.969515,1732],[-82.981201,39.967579,748],[-82.993589,39.96536,295],[-82.977735,39.967753,880],[-82.99955,39.965253,56],[-82.964446,39.968643,1379],[-82.994757,39.96595,236],[-82.993426,39.965692,295],[-82.97597,39.967565,943],[-82.994429,39.965957,254],[-82.9626,39.9687,1449],[-82.97587,39.967609,949],[-82.993662,39.965654,295],[-82.967068,39.968501,1281],[-82.993155,39.965704,295],[-82.964889,39.968663,1363],[-82.998668,39.965077,89],[-82.964339,39.968638,1385],[-82.954777,39.96987,1734],[-82.993269,39.965495,295],[-82.958511,39.968356,1597],[-82.993633,39.965526,295],[-82.951162,39.968947,1836],[-82.97597,39.967565,945],[-82.966744,39.969178,1298],[-82.964203,39.96863,1389],[-82.966744,39.969178,1298],[-82.96931,39.968289,1197],[-82.965146,39.969272,1354],[-82.964679,39.969246,1372],[-82.954701,39.968349,1735],[-82.980028,39.967219,791],[-82.977425,39.96754,887],[-82.977428,39.967899,898],[-82.965574,39.969267,1342],[-82.975707,39.967659,953],[-82.95478,39.96987,1734],[-82.953064,39.969025,1802],[-82.981971,39.967008,715],[-82.976611,39.967903,924],[-82.96274,39.968705,1441],[-82.954847,39.970059,1736],[-82.972932,39.967876,1059],[-82.954532,39.970245,1738],[-82.97275,39.96842,1070],[-82.954722,39.969001,1728]]}'), 4326)
            );

            COMMIT;
        `, (err, res) => {
            q.error(err);
            q.end();
        });
    });

    t.test('Run', (q) => {
        split.init({
            pool: {
                max: 10,
                user: 'postgres',
                database: 'pt_test',
                idleTimeoutMillis: 30000
            },
            stdout: false,
            debug: true,
            country: 'us'
        });

        split.split(2, (err, ress) => {
            q.error(err);

            t.equals(ress.length, 2);

            for (let res of ress) {
                t.equals(res.type, 'Feature', 'Type should be feature');
                t.equals(res.geometry.type, 'GeometryCollection', 'Geometry should be GeometryCollection');
                t.equals(res.geometry.geometries.length, 2, 'GeometryCollection should have 2 child geometries');

                t.equals(res.properties['carmen:text'], 'East Long Street', 'Text should be East Long Street');
            }
            t.equals(ress[0].geometry.geometries[0].coordinates.length, 7);
            t.equals(ress[1].geometry.geometries[0].coordinates.length, 3);


            split.kill();
            q.end();
        });
    });

    t.end();
});

test('Split: (with no output) Mt Thor Way', (t) => {
    t.test('Populate', (q) => {
        pool.query(`
            BEGIN;

            INSERT INTO network_cluster (
                text,
                _text,
                address,
                geom
            ) VALUES (
                'mt thor way',
                'Mount Thor Way',
                3,
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiLineString","coordinates":[[[-76.576516,39.464153,1],[-76.5769,39.463908,1],[-76.577122,39.463783,1],[-76.577421,39.463643,1],[-76.577877,39.463512,1],[-76.578492,39.463369,1]],[[-76.602014,39.402035,1],[-76.601978,39.402217,1],[-76.601954,39.402319,1],[-76.601917,39.402539,1],[-76.601845,39.402765,1]],[[-76.578492,39.463369,1],[-76.582147,39.462461,1],[-76.582404,39.462397,1]],[[-76.600369,39.41315,1],[-76.600366,39.413354,1]],[[-76.600406,39.411645,1],[-76.600382,39.412418,1]],[[-76.600492,39.410394,1],[-76.600451,39.410653,1],[-76.60041,39.41088,1],[-76.600336,39.411446,1],[-76.600406,39.411645,1]],[[-76.593006,39.450177,1],[-76.593305,39.449648,1],[-76.594053,39.448353,1]],[[-76.574924,39.464219,1],[-76.574729,39.464269,1],[-76.574219,39.464399,1],[-76.57344,39.46457,1],[-76.573092,39.464651,1],[-76.572714,39.46473,1],[-76.572136,39.464832,1],[-76.571591,39.464935,1],[-76.571038,39.46504,1],[-76.570812,39.46509,1],[-76.570619,39.465133,1],[-76.570455,39.465176,1],[-76.57018,39.465255,1],[-76.569994,39.465303,1],[-76.56971,39.465373,1],[-76.569342,39.465465,1],[-76.569079,39.465541,1],[-76.568736,39.465632,1],[-76.568498,39.4657,1],[-76.56828,39.465742,1],[-76.567992,39.465782,1],[-76.567658,39.465828,1],[-76.567398,39.465864,1],[-76.567136,39.465905,1],[-76.566835,39.46594,1],[-76.566575,39.465982,1],[-76.566107,39.466057,1],[-76.566008,39.466069,1],[-76.56593,39.466085,1],[-76.565675,39.466123,1],[-76.565167,39.466205,1],[-76.56441,39.466322,1],[-76.563693,39.466431,1],[-76.562984,39.466548,1],[-76.562633,39.466601,1]],[[-76.601239,39.405939,1],[-76.6012,39.40607,1]],[[-76.600376,39.412627,1],[-76.600373,39.412857,1]],[[-76.582404,39.462397,1],[-76.582729,39.462317,1],[-76.582965,39.462269,1],[-76.583168,39.462246,1],[-76.583408,39.462229,1],[-76.583675,39.462234,1],[-76.583948,39.462265,1],[-76.58421,39.462314,1],[-76.584724,39.462423,1],[-76.584838,39.462447,1],[-76.585182,39.462519,1],[-76.585538,39.46257,1],[-76.58583,39.462585,1],[-76.586165,39.462579,1],[-76.586339,39.462563,1],[-76.586438,39.462554,1],[-76.586804,39.462493,1],[-76.587058,39.462431,1],[-76.58736,39.462336,1],[-76.587632,39.462222,1],[-76.58787,39.462106,1],[-76.588141,39.461937,1],[-76.588385,39.461763,1],[-76.588681,39.46153,1],[-76.588933,39.461323,1],[-76.589066,39.461203,1],[-76.589203,39.461071,1]],[[-76.600382,39.412418,1],[-76.600376,39.412627,1]],[[-76.589203,39.461071,1],[-76.589278,39.460996,1],[-76.589364,39.460892,1]],[[-76.600406,39.411645,1],[-76.600489,39.411464,1],[-76.600499,39.411338,1]],[[-76.601587,39.40416,1],[-76.60152,39.404488,1]],[[-76.589364,39.460892,1],[-76.589423,39.460819,1],[-76.58947,39.460761,1],[-76.589582,39.4606,1],[-76.58975,39.460303,1],[-76.589939,39.459931,1],[-76.5905,39.458797,1],[-76.59147,39.456834,1],[-76.591905,39.455952,1],[-76.592051,39.455657,1],[-76.592176,39.455388,1],[-76.592216,39.455281,1],[-76.592274,39.455124,1],[-76.592345,39.454874,1],[-76.592391,39.454595,1],[-76.592422,39.454321,1],[-76.592426,39.454018,1],[-76.592456,39.451923,1],[-76.592464,39.451671,1],[-76.592471,39.451621,1],[-76.592494,39.451435,1],[-76.592544,39.451218,1],[-76.592609,39.451008,1],[-76.592679,39.450817,1],[-76.592798,39.45056,1],[-76.593006,39.450177,1]],[[-76.601424,39.405984,1],[-76.60148,39.405684,1],[-76.601504,39.405536,1],[-76.601565,39.405193,1]],[[-76.601334,39.4054,1],[-76.601239,39.405939,1]],[[-76.600366,39.413354,1],[-76.600345,39.413727,1],[-76.600316,39.413967,1]],[[-76.601882,39.403391,1],[-76.601901,39.403272,1],[-76.601947,39.402979,1],[-76.602005,39.402702,1],[-76.602099,39.402235,1],[-76.602138,39.402172,1],[-76.602205,39.402116,1]],[[-76.562633,39.466601,1],[-76.562225,39.466653,1],[-76.561805,39.466717,1],[-76.561565,39.466755,1],[-76.561022,39.466834,1],[-76.560887,39.466856,1],[-76.560435,39.46693,1],[-76.559938,39.467008,1],[-76.558849,39.467181,1],[-76.558268,39.467274,1],[-76.557817,39.467346,1],[-76.557552,39.467389,1],[-76.557331,39.46743,1],[-76.556974,39.467507,1],[-76.556764,39.467556,1],[-76.55646,39.467645,1],[-76.556336,39.467684,1],[-76.555562,39.467919,1],[-76.552434,39.468888,1],[-76.552262,39.468941,1],[-76.552127,39.468977,1],[-76.551989,39.469007,1],[-76.551815,39.469031,1],[-76.551611,39.469046,1],[-76.551363,39.469049,1],[-76.551169,39.469033,1],[-76.551079,39.469018,1],[-76.550969,39.468993,1],[-76.550842,39.468961,1],[-76.550705,39.468921,1],[-76.550493,39.468848,1],[-76.550352,39.468784,1],[-76.550124,39.46868,1],[-76.549697,39.468478,1],[-76.547758,39.46756,1],[-76.547661,39.467514,1],[-76.547553,39.467455,1],[-76.547479,39.467405,1],[-76.547417,39.46735,1],[-76.547329,39.467275,1]],[[-76.601276,39.406995,1],[-76.601292,39.406892,1],[-76.60137,39.406369,1]],[[-76.595458,39.445992,1],[-76.595553,39.445832,1]],[[-76.595553,39.445832,1],[-76.596122,39.444875,1],[-76.596405,39.444372,1],[-76.596528,39.444116,1],[-76.596642,39.443864,1],[-76.596711,39.44367,1],[-76.596779,39.443434,1],[-76.596843,39.44319,1],[-76.596884,39.442967,1],[-76.596913,39.442723,1],[-76.596926,39.442509,1],[-76.596928,39.441396,1],[-76.59692,39.441196,1],[-76.596918,39.44022,1]],[[-76.600499,39.411338,1],[-76.600558,39.410891,1],[-76.600593,39.410672,1],[-76.600693,39.410131,1],[-76.600774,39.409686,1]],[[-76.601737,39.404221,1],[-76.601748,39.404158,1],[-76.601804,39.403841,1]],[[-76.600056,39.414926,1],[-76.600155,39.414631,1],[-76.60021,39.414429,1],[-76.600267,39.414208,1],[-76.600316,39.413967,1]],[[-76.599893,39.41542,1],[-76.600056,39.414926,1]],[[-76.601399,39.406105,1],[-76.601424,39.405984,1]],[[-76.601804,39.403841,1],[-76.601882,39.403391,1]],[[-76.594053,39.448353,1],[-76.594626,39.4474,1],[-76.595096,39.446604,1],[-76.595325,39.446211,1],[-76.595458,39.445992,1]],[[-76.601024,39.408414,1],[-76.601042,39.408312,1],[-76.601115,39.40794,1],[-76.601167,39.407678,1]],[[-76.596918,39.44022,1],[-76.596898,39.436518,1],[-76.596897,39.436472,1],[-76.596889,39.434313,1],[-76.596867,39.431962,1],[-76.596848,39.431778,1],[-76.596803,39.43161,1],[-76.59674,39.431453,1],[-76.596661,39.431306,1],[-76.596543,39.431121,1],[-76.596502,39.431071,1],[-76.596388,39.430936,1],[-76.596057,39.430574,1],[-76.595885,39.430368,1],[-76.595766,39.430187,1],[-76.595668,39.430005,1],[-76.595582,39.429797,1],[-76.595531,39.429567,1],[-76.59552,39.4294,1],[-76.595526,39.429192,1],[-76.595553,39.429042,1],[-76.595606,39.42884,1],[-76.595626,39.428777,1],[-76.595632,39.428759,1],[-76.595783,39.428275,1],[-76.595969,39.42764,1]],[[-76.601669,39.404603,1],[-76.601685,39.404512,1],[-76.601737,39.404221,1]],[[-76.6012,39.40607,1],[-76.601134,39.406453,1],[-76.601073,39.406839,1],[-76.600943,39.407652,1],[-76.600765,39.408823,1],[-76.600711,39.409208,1],[-76.600695,39.409302,1]],[[-76.601746,39.403258,1],[-76.601724,39.403371,1],[-76.601587,39.40416,1]],[[-76.600373,39.412857,1],[-76.600369,39.41315,1]],[[-76.600774,39.409686,1],[-76.600857,39.409227,1]],[[-76.595969,39.42764,1],[-76.596092,39.427106,1]],[[-76.60152,39.404488,1],[-76.60151,39.404542,1],[-76.601503,39.404581,1],[-76.601424,39.405054,1],[-76.601342,39.405355,1],[-76.601334,39.4054,1]],[[-76.596092,39.427106,1],[-76.596147,39.426882,1],[-76.596197,39.426705,1]],[[-76.599795,39.415695,1],[-76.599893,39.41542,1]],[[-76.596197,39.426705,1],[-76.596268,39.426468,1],[-76.596369,39.42617,1],[-76.596486,39.425856,1],[-76.596596,39.425604,1],[-76.596652,39.425461,1],[-76.596766,39.425172,1],[-76.596985,39.424507,1],[-76.597012,39.424424,1],[-76.597301,39.423454,1],[-76.597402,39.423097,1],[-76.597594,39.422482,1],[-76.597965,39.421246,1],[-76.598288,39.420189,1],[-76.598626,39.419155,1],[-76.598739,39.41881,1],[-76.59892,39.418253,1],[-76.599305,39.417081,1],[-76.599795,39.415695,1]],[[-76.60137,39.406369,1],[-76.601382,39.406292,1],[-76.601399,39.406105,1]],[[-76.547329,39.467275,1],[-76.54726,39.467217,1],[-76.547139,39.467144,1],[-76.547081,39.467117,1],[-76.547032,39.467109,1],[-76.546996,39.467106,1],[-76.546973,39.467109,1],[-76.546929,39.46712,1],[-76.546904,39.467136,1],[-76.546869,39.467158,1],[-76.546825,39.467207,1],[-76.546797,39.467264,1],[-76.546605,39.467657,1],[-76.54603,39.468831,1],[-76.54575,39.469372,1],[-76.545512,39.469869,1],[-76.545393,39.470077,1],[-76.545251,39.47027,1],[-76.545103,39.470416,1],[-76.544997,39.470512,1],[-76.544834,39.47064,1],[-76.544761,39.470694,1],[-76.544603,39.470779,1],[-76.544457,39.470848,1],[-76.54441,39.470873,1],[-76.544018,39.471032,1],[-76.543776,39.471134,1],[-76.543538,39.471234,1],[-76.543104,39.471411,1],[-76.54231,39.471739,1],[-76.541944,39.47189,1],[-76.541123,39.472255,1],[-76.540592,39.472522,1],[-76.540341,39.472663,1],[-76.540136,39.472792,1],[-76.539991,39.472901,1],[-76.539904,39.472969,1],[-76.539809,39.473066,1],[-76.539338,39.473639,1],[-76.539125,39.473937,1],[-76.538945,39.474136,1],[-76.538784,39.474323,1],[-76.538611,39.474504,1],[-76.538454,39.474664,1],[-76.53804,39.475066,1],[-76.537532,39.475552,1],[-76.537352,39.475719,1],[-76.537156,39.475914,1],[-76.536873,39.476194,1],[-76.536729,39.476352,1],[-76.536634,39.476469,1],[-76.53606,39.477108,1],[-76.535863,39.477352,1],[-76.535423,39.477853,1],[-76.535117,39.478209,1],[-76.534695,39.478798,1],[-76.534547,39.47901,1],[-76.534403,39.479203,1],[-76.534359,39.479259,1],[-76.534185,39.479518,1],[-76.534044,39.479694,1],[-76.533781,39.479982,1],[-76.533702,39.480069,1],[-76.533628,39.480134,1],[-76.533574,39.480181,1],[-76.533423,39.480326,1],[-76.533282,39.480447,1],[-76.532651,39.480912,1],[-76.532109,39.481308,1],[-76.531774,39.481545,1],[-76.531448,39.481746,1],[-76.529239,39.483128,1],[-76.529073,39.483223,1],[-76.52891,39.483339,1],[-76.528772,39.483441,1],[-76.528694,39.483515,1],[-76.528616,39.483592,1],[-76.528538,39.483692,1],[-76.52846,39.483829,1],[-76.528302,39.484154,1],[-76.528199,39.484381,1],[-76.528119,39.484571,1],[-76.528069,39.484715,1],[-76.528031,39.484818,1],[-76.527997,39.484989,1],[-76.527969,39.485176,1],[-76.527957,39.485676,1],[-76.527948,39.4859,1],[-76.527937,39.486051,1],[-76.527915,39.486228,1],[-76.527783,39.487001,1],[-76.527729,39.487231,1],[-76.527653,39.487481,1],[-76.527578,39.487635,1],[-76.527503,39.487759,1],[-76.527452,39.487833,1],[-76.527384,39.487909,1],[-76.527238,39.488027,1],[-76.527171,39.488069,1],[-76.52705,39.488145,1],[-76.526918,39.488227,1],[-76.526676,39.488351,1],[-76.526464,39.488439,1],[-76.526436,39.488449,1],[-76.526212,39.488525,1],[-76.525626,39.488683,1],[-76.525343,39.488756,1],[-76.525136,39.488803,1],[-76.524699,39.488927,1],[-76.524397,39.489011,1],[-76.52425,39.48906,1],[-76.524132,39.489102,1],[-76.52397,39.489178,1],[-76.523305,39.489583,1],[-76.523107,39.489698,1],[-76.522888,39.489815,1]],[[-76.601565,39.405193,1],[-76.601669,39.404603,1]],[[-76.601845,39.402765,1],[-76.601833,39.402801,1],[-76.601746,39.403258,1]],[[-76.576516,39.464153,1],[-76.576371,39.464027,1],[-76.576276,39.463968,1],[-76.576202,39.463946,1],[-76.576118,39.463939,1],[-76.576024,39.463953,1],[-76.575812,39.464002,1],[-76.57536,39.46411,1],[-76.57509,39.464178,1],[-76.574924,39.464219,1]],[[-76.600857,39.409227,1],[-76.600978,39.408678,1],[-76.601024,39.408414,1]],[[-76.601167,39.407678,1],[-76.601226,39.407312,1],[-76.601276,39.406995,1]],[[-76.600695,39.409302,1],[-76.600492,39.410394,1]]]}'), 4326)
            );

            INSERT INTO address_cluster (
                _text,
                geom
            ) VALUES (
                '{"MT THOR WAY"}',
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiPoint","coordinates":[[-76.554825,39.460839,1000],[-76.567178,39.462854,-1],[-76.597763,39.442952,5432],[-76.597381,39.438022,-4543],[-76.599005,39.431047,-4831]]}'), 4326)
            );

            COMMIT;
        `, (err, res) => {
            q.error(err);
            q.end();
        });
    });

    t.test('Run', (q) => {
        split.init({
            pool: {
                max: 10,
                user: 'postgres',
                database: 'pt_test',
                idleTimeoutMillis: 30000
            },
            stdout: false,
            debug: true,
            country: 'us'
        });

        split.split(3, (err, res) => {
            q.error(err);

            t.equals(res.length, 1);

            res = res[0];

            t.equals(res.type, 'Feature', 'Type should be feature');
            t.equals(res.geometry.type, 'GeometryCollection', 'Geometry should be GeometryCollection');
            t.equals(res.geometry.geometries.length, 2, 'GeometryCollection should have 2 child geometries');

            t.equals(res.properties['carmen:text'], 'Mount Thor Way', 'Text should be Mount Thor Way');
            t.deepEquals(res.properties['carmen:addressnumber'], [ null, [ '1000', '5432' ] ], 'Epheremal addrpts dropped');
            split.kill();
            q.end();
        });
    });

    t.end();
});

test('Init Database', (t) => {
    const index = new Index(pool);

    index.init((err) => {
        t.error(err);
        t.end();
    });
});

/**
 * Roads should be split into a max distance as defined by explode#split
 * Ensure roads that pass into cluster#break don't exceed this threshold
 */
test('Split: Ensure cluster#break roads are split', (t) => {
    t.test('Populate', (q) => {
        pool.query(`
            BEGIN;

            INSERT INTO network_cluster (
                text,
                _text,
                address,
                geom
            ) VALUES (
                'really long rd',
                'Really Long road',
                1,
                ST_SetSRID(ST_GeomFromGeoJSON('{"type": "MultiLineString", "coordinates": [ [ [ -81.65313720703125, 38.35673412466715, 1 ], [ -81.46087646484375, 38.48154475346391, 1 ], [ -81.38671875, 38.51378825951165, 1 ], [ -81.26861572265625, 38.56105262446978, 1 ], [ -81.1669921875, 38.59755381474309, 1 ], [ -81.14089965820312, 38.56105262446978, 1 ], [ -81.10931396484374, 38.57501115220884, 1 ], [ -81.02691650390625, 38.61579745317872, 1 ], [ -80.97610473632811, 38.61579745317872, 1 ], [ -80.91293334960938, 38.60292007223949, 1 ], [ -80.78384399414062, 38.60721278935162, 1 ], [ -80.73165893554688, 38.63189092902837, 1 ], [ -80.72616577148438, 38.66835610151506, 1 ], [ -80.6781005859375, 38.70694605159386, 1 ], [ -80.66299438476562, 38.7508703622086, 1 ], [ -80.65750122070312, 38.79904887985135, 1 ], [ -80.66299438476562, 38.83542884007305, 1 ], [ -80.65338134765625, 38.86751337001198, 1 ], [ -80.58334350585938, 38.9070643560226, 1 ] ] ] }'), 4326)
            );

            INSERT INTO address_cluster (
                _text,
                geom
            ) VALUES (
                '{"REALLY LONG ROAD"}',
                ST_SetSRID(ST_GeomFromGeoJSON('{"type":"MultiPoint","coordinates": [[-80.67535400390625,38.91561302513129, 1], [ -80.74127197265625, 38.70908932739828, 3 ], [ -81.14227294921875, 38.6329636990003, 3 ], [ -81.55014038085938, 38.477244528955595, 1 ], [ -80.54214477539062, 38.817241182948266, 2 ], [ -80.64102172851561, 38.6233081913603, 4 ], [ -81.04888916015625, 38.4783196091326, 4 ], [ -81.53228759765625, 38.33734763569314, 2 ] ] }'), 4326)
            );

            COMMIT;
        `, (err, res) => {
            q.error(err);
            q.end();
        });
    });

    t.test('Run', (q) => {
        split.init({
            pool: {
                max: 10,
                user: 'postgres',
                database: 'pt_test',
                idleTimeoutMillis: 30000
            },
            stdout: false,
            debug: true,
            country: 'us'
        });

        split.split(1, (err, ress) => {
            q.error(err);

            t.equals(ress.length, 2);

            for (let res of ress) {
                t.equals(res.type, 'Feature', 'Type should be feature');
                t.equals(res.geometry.type, 'GeometryCollection', 'Geometry should be GeometryCollection');
                t.equals(res.geometry.geometries.length, 2, 'GeometryCollection should have 2 child geometries');

                for (let ln of res.geometry.geometries[0].coordinates) {
                    t.ok(turf.lineDistance(turf.lineString(ln)) < 0.51, 'does not exceed max seg length');
                }
            }

            split.kill();
            q.end();
        });
    });

    t.end();
});

test('End connection, close db', (t) => {
    const index = new Index(pool);

    index.init((err) => {
        t.error(err);
        t.end();
    });

    pool.end();
    t.end();
});
